<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoTrack • Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary:#4361ee; --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --dark:#0f172a; --light:#f8fafc; --gray:#94a3b8; --glass:rgba(255,255,255,0.12); --border:rgba(255,255,255,0.18);}    
    * { box-sizing: border-box; }
    body { font-family:'Inter',sans-serif; background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#334155 100%); color:#e2e8f0; min-height:100vh; }
    .navbar-custom{ background:rgba(15,23,42,.75); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); }
    .glass{ background:var(--glass); backdrop-filter:blur(16px); border:1px solid var(--border); border-radius:20px; box-shadow:0 12px 40px rgba(0,0,0,.35); }
    .quiz-container{ max-width:1200px; margin:32px auto; padding:0 16px; }

    .quiz-header{ padding:20px 24px; }
    .quiz-title{ font-weight:700; letter-spacing:.2px; }
    .subtitle{ color:var(--gray); }

    .progress{ height:12px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; }
    .progress-bar{ background:linear-gradient(135deg, var(--primary), var(--success)); }

    .quiz-card{ padding:28px; }
    .question-text{ font-size:1.5rem; font-weight:700; line-height:1.55; color:#ffffff; }

    .option{ display:flex; align-items:center; gap:16px; width:100%; text-align:left; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); border-radius:16px; padding:20px 22px; transition:transform .15s ease, background .2s ease, border-color .2s ease; cursor:pointer; font-size:1.05rem; }
    .option .bullet{ width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:12px; background:rgba(255,255,255,.10); color:#e2e8f0; font-weight:700; }
    .option:hover{ background:rgba(67,97,238,.18); transform:translateY(-1px); }
    .option.correct{ border-color: rgba(16,185,129,.85); background: rgba(16,185,129,.12); }
    .option.wrong{ border-color: rgba(239,68,68,.85); background: rgba(239,68,68,.10); }

    .aside-card{ padding:22px; }
    .stat-item{ display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.08); }
    .stat-item:last-child{ border-bottom:0; }
    .stat-value{ font-weight:700; }

    .controls .btn{ min-width:180px; padding:.9rem 1.25rem; border-radius:12px; }

    @media (max-width: 991.98px){
      .controls .btn{ min-width:140px; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-custom sticky-top">
    <div class="container-fluid px-4">
      <a class="navbar-brand fw-bold fs-4" href="{% url 'dashboard' %}"><i class="fas fa-leaf text-success me-2"></i>EcoTrack <span class="text-primary">IoT</span></a>
      <div class="d-flex align-items-center gap-2">
        <a href="{% url 'dashboard' %}" class="btn btn-outline-light btn-sm"><i class="fas fa-gauge-high me-1"></i> Dashboard</a>
      </div>
    </div>
  </nav>

  <div class="quiz-container">
    <div class="glass quiz-header mb-3">
      <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-2">
        <div>
          <h3 class="quiz-title mb-1"><i class="fas fa-circle-question text-primary me-2"></i>Quiz Éco-Responsable</h3>
          <div class="subtitle">Mettre à l’épreuve vos connaissances sur les indicateurs et bonnes pratiques IoT durables</div>
        </div>
        <div class="d-flex align-items-center gap-3">
          <div class="badge bg-primary p-2 px-3 fs-6">Score: <span id="score">0</span></div>
          <div class="text-secondary">Question <span id="qIndex">1</span>/<span id="qTotal">4</span></div>
        </div>
      </div>
      <div class="progress mt-3">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
      </div>
    </div>

    <div class="row g-4 align-items-start">
      <!-- Zone question -->
      <div class="col-12 col-lg-8">
        <div class="glass quiz-card" id="quiz">
          <!-- Injecté par JS -->
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3 controls">
          <button id="prevBtn" class="btn btn-outline-light" disabled>
            <i class="fas fa-arrow-left me-2"></i> Précédent
          </button>
          <button id="nextBtn" class="btn btn-primary" disabled>
            Suivant <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>

      <!-- Zone infos -->
      <div class="col-12 col-lg-4">
        <div class="glass aside-card">
          <h5 class="mb-3"><i class="fas fa-chart-simple text-success me-2"></i>Votre progression</h5>
          <div class="stat-item">
            <span>Questions totales</span>
            <span class="stat-value" id="statTotal">4</span>
          </div>
          <div class="stat-item">
            <span>Répondues</span>
            <span class="stat-value" id="statAnswered">0</span>
          </div>
          <div class="stat-item">
            <span>Correctes</span>
            <span class="stat-value" id="statCorrect">0</span>
          </div>
          <div class="stat-item">
            <span>Restantes</span>
            <span class="stat-value" id="statRemaining">4</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Jeu de questions (exemple) sur le thème éco/IoT
    const questions = [
      {
        q: "Quel indicateur reflète l'impact environnemental global d'un device ?",
        options: ["CPU %", "Score Éco", "Requêtes/min", "Cloud %"],
        answer: 1
      },
      {
        q: "Un score d'obsolescence élevé signifie ?",
        options: ["Matériel récent", "Longue durée de vie", "Risque d'outdated important", "Dépendance faible"],
        answer: 2
      },
      {
        q: "Quelle métrique traduit directement la consommation d'énergie ?",
        options: ["Watts", "CO₂ (g)", "RAM %", "CPU %"],
        answer: 0
      },
      {
        q: "Réduire la dépendance Cloud a pour effet probable ?",
        options: ["Augmenter CO₂", "Réduire latence", "Réduire empreinte et coûts", "Diminuer disponibilité"],
        answer: 2
      }
    ];

    let current = 0;
    let score = 0;
    const selected = new Array(questions.length).fill(null);

    function updateStats(){
      const answered = selected.filter(v=>v!==null).length;
      const remaining = questions.length - answered;
      document.getElementById('statTotal').textContent = questions.length;
      document.getElementById('statAnswered').textContent = answered;
      document.getElementById('statRemaining').textContent = remaining;
      document.getElementById('statCorrect').textContent = score;
    }

    function renderQuestion(){
      const q = questions[current];
      const root = document.getElementById('quiz');
      const pct = Math.round(((current) / questions.length) * 100);
      document.getElementById('progressBar').style.width = `${pct}%`;
      document.getElementById('qIndex').textContent = current+1;
      document.getElementById('qTotal').textContent = questions.length;

      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      prevBtn.disabled = current === 0;
      nextBtn.textContent = current === questions.length - 1 ? 'Terminer' : 'Suivant';

      root.innerHTML = `
        <div class="mb-3">
          <div class="badge bg-secondary-subtle text-light">Question ${current+1}</div>
        </div>
        <div class="question-text mb-4">${q.q}</div>
        <div class="row g-3">
          ${q.options.map((opt,i)=>`
            <div class="col-12">
              <button type="button" class="option ${selected[current]!==null ? (i===q.answer?'correct': (i===selected[current]?'wrong':'')) : ''}" data-index="${i}">
                <span class="bullet">${String.fromCharCode(65+i)}</span>
                <span>${opt}</span>
              </button>
            </div>`).join('')}
        </div>`;

      // Activer/désactiver Next selon sélection actuelle
      nextBtn.disabled = (selected[current] === null);

      root.querySelectorAll('.option').forEach(el=>{
        el.addEventListener('click', ()=>{
          if(selected[current]!==null) return; // déjà répondu
          const idx = Number(el.dataset.index);
          selected[current] = idx;
          if(idx === questions[current].answer) score++;
          document.getElementById('score').textContent = score;
          nextBtn.disabled = false;
          renderQuestion();
          updateStats();
        });
      });
    }

    document.getElementById('prevBtn').addEventListener('click', ()=>{ if(current>0){ current--; renderQuestion(); }});
    document.getElementById('nextBtn').addEventListener('click', ()=>{
      if(current < questions.length-1){ current++; renderQuestion(); }
      else {
        document.getElementById('progressBar').style.width = '100%';
        const root = document.getElementById('quiz');
        root.innerHTML = `<div class='text-center py-5'>
          <div class='mb-3'><i class="fas fa-trophy fa-3x text-warning"></i></div>
          <h3 class='mb-2'>Résultat</h3>
          <p class='lead mb-3'>Score final: <strong>${score}/${questions.length}</strong></p>
          <a href='{% url "dashboard" %}' class='btn btn-success btn-lg mt-2'><i class='fas fa-gauge-high me-2'></i>Retour au Dashboard</a>
        </div>`;
        document.getElementById('prevBtn').disabled = true;
        document.getElementById('nextBtn').disabled = true;
      }
    });

    // Init
    document.getElementById('score').textContent = score;
    updateStats();
    renderQuestion();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
